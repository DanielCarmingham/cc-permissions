{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/DanielCarmingham/cc-permissions/blob/main/templates/template.schema.json",
  "title": "CC-Permissions Template",
  "description": "Schema for permission templates in cc-permissions",
  "type": "object",
  "required": ["name", "description", "levels"],
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "name": {
      "type": "string",
      "description": "Template identifier (lowercase, no spaces)",
      "pattern": "^[a-z][a-z0-9-]*$"
    },
    "description": {
      "type": "string",
      "description": "Brief description of what this template covers"
    },
    "category": {
      "type": "string",
      "description": "Category for grouping templates in list output"
    },
    "detection": {
      "type": "object",
      "description": "Optional rules for auto-detecting when this template should be recommended",
      "additionalProperties": false,
      "properties": {
        "files": {
          "type": "array",
          "description": "File patterns that indicate this template (supports globs like *.csproj)",
          "items": { "type": "string" }
        },
        "directories": {
          "type": "array",
          "description": "Directory patterns that indicate this template (e.g., .git/, .github/workflows/)",
          "items": { "type": "string" }
        },
        "contentPatterns": {
          "type": "array",
          "description": "File + content patterns for ambiguous detection",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "file": { "type": "string", "description": "File to check" },
              "contains": { "type": "string", "description": "Text that must be present in the file" }
            },
            "required": ["file", "contains"]
          }
        },
        "mcpServers": {
          "type": "array",
          "description": "MCP server names that indicate this template (checks active servers via `claude mcp list`)",
          "items": { "type": "string" }
        },
        "commands": {
          "type": "array",
          "description": "CLI commands that must be available on the system (checked via `which` or `command -v`)",
          "items": { "type": "string" }
        },
        "gitRemotes": {
          "type": "array",
          "description": "Git remote URL patterns to match (e.g., \"github.com\", \"gitea.\", \"gitlab.com\")",
          "items": { "type": "string" }
        },
        "always": {
          "type": "boolean",
          "description": "If true, this template is always recommended (e.g., shell baseline)"
        }
      }
    },
    "levels": {
      "type": "object",
      "description": "Permission levels (cumulative: standard includes restrictive, permissive includes standard)",
      "required": ["restrictive", "standard", "permissive"],
      "additionalProperties": false,
      "properties": {
        "restrictive": {
          "type": "array",
          "description": "Read-only operations (exploration, status checks)",
          "items": { "$ref": "#/$defs/permission" }
        },
        "standard": {
          "type": "array",
          "description": "Dev workflow commands (builds, tests, commits)",
          "items": { "$ref": "#/$defs/permission" }
        },
        "permissive": {
          "type": "array",
          "description": "Commands with broader access (installs, publishes)",
          "items": { "$ref": "#/$defs/permission" }
        }
      }
    }
  },
  "$defs": {
    "permission": {
      "type": "object",
      "required": ["command"],
      "additionalProperties": false,
      "properties": {
        "command": {
          "type": "string",
          "description": "The command or pattern to allow"
        },
        "description": {
          "type": "string",
          "description": "Optional description for documentation"
        },
        "type": {
          "type": "string",
          "enum": ["bash", "mcp"],
          "description": "Permission type: 'bash' for shell commands (default), 'mcp' for MCP tool permissions"
        }
      }
    }
  }
}
